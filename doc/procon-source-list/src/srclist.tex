%---------------------------------------------------------------------
%
%  プロコン ソースコード印刷(両面印刷用)のサンプル
%
%  Notice:
%    (1) \tableofcontents や \Lastpage を使用するため、
%        2回か3回 platex で処理する必要がある。
%    (2) LaTeX の都合でうまく組版されない場合もある。
%        必ず全ページを目で確認すること。
%    (3) jsarticle は LaTeX で有名な奥村先生のパッケージである。
%        角藤版W32TeXではすでにインストールされている。
%        なければ以下から。
%        http://oku.edu.mie-u.ac.jp/~okumura/jsclasses/
%    (4) 両面印刷を前提としているため、たとえば表紙と目次の間のように、
%        真っ白なページが挿入されることがあるが間違いではない。
%
%  Last updated: October 13, 2008
%  Compiled by Shoichi Ito
%
%---------------------------------------------------------------------
\documentclass[a4paper]{jsarticle}

\usepackage{proconsrc}

\usepackage{atbegshi}
\ifnum 42146=\euc"A4A2
  \AtBeginShipoutFirst{\special{pdf:tounicode EUC-UCS2}}
\else
  \AtBeginShipoutFirst{\special{pdf:tounicode 90ms-RKSJ-UCS2}}
\fi
\usepackage{xcolor}
\usepackage[dvipdfmx,
	bookmarks=true,
	bookmarksnumbered=true,
	colorlinks=false,
	linkbordercolor=blue,
	pdftitle={カンファイン・ソースコードリスト},
	pdfauthor={長野高専 課題部門 カンファイン},
]{hyperref}

%%%%%%%%%%%%%%%%%%%%%% ここを書き換える %%%%%%%%%%%%%%%%%%%%%%
%  第何回?
\newcommand{\Kai}{22}

%  部門
\newcommand{\Bumon}{課題}

%  登録番号
\newcommand{\TourokuBangou}{10034}

%  プレゼンテーション順序
\newcommand{\Junban}{6}

%  作品名
\newcommand{\Sakuhin}{カンファイン}

%  メンバー5人分
\newcommand{\MemberA}{奥本　隼}
\newcommand{\MemberB}{若林　哲宇}
\newcommand{\MemberC}{大和　優介}
\newcommand{\MemberD}{宮崎　大智}
\newcommand{\MemberE}{矢口　裕也}

%  指導教員
\newcommand{\Teacher}{伊藤　祥一}

%  学校名
\newcommand{\School}{長野工業高等専門学校}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%  ソースコードを引用するためのリスト環境の設定
%
%  各自の好みで設定する。
%  設定内容については以下参照。
%  http://www.biwako.shiga-u.ac.jp/sensei/kumazawa/tex/listings.html
\lstset{language=ruby,
  basicstyle=\ttfamily\small,
  commentstyle=\textit,
  classoffset=1,
  keywordstyle=\bfseries,
  frame=trbl,  % none → tRBL で上下左右の囲み
  framesep=5pt,
  showstringspaces=false,
  numbers=left,
  stepnumber=1,
  numberstyle=\footnotesize,
  tabsize=2,
  breaklines=true
}



%----------------
\begin{document}

%  表紙
\MakeCoverPage

%  目次
\MakeTOC

%%%%%%%%%%%%%%%%%%%%%% ここを書き換える %%%%%%%%%%%%%%%%%%%%%%
%  以下、\InputSource{}の引数としてソースファイル名を並べる。
%  必要に応じて改ページや LaTeX の命令を入れる。
\section{はじめに}
本システム（カンファイン）は，
イベントへの参加登録などをする「Webシステム（サーバ）」と
当日の受付でQRコードを読み取る「受付システム（クライアント）」の2つのシステムから成り立っている．
それぞれ，「Ruby on Rails」と「C\#(.NET Framework 4)」で開発を行った．


「Ruby on Rails」は，MVC（Model, View, Controller）パターンで成り立っている．
そのため，Webシステムのソースコードリストでは，
データ構造およびロジックに相当するModel, Controllerについて紹介する．
また，「設定や定義」，「Viewに関わるロジック」についても紹介する．

「受付システム」のソースコードについても同様に，フォームのソースコードについては省略する．

\include{model}

\section{データベース構造定義ファイル}
\InputSource{../tmp-source/db/schema.rb}{db/schema.rb}

\include{controller}

\include{javascript}

\include{helper}

\include{config}


\section{メール送信に関するクラス}

以下のコードは「メール一斉配信機能」と「参加登録完了通知」のメールに関する設定である．
送信先や，添付ファイルなどの設定を行っている．

\InputSource{../tmp-source/app/mailers/event_mailer.rb}{app/mailers/event\_mailer.rb}
\InputSource{../tmp-source/app/mailers/entry_mailer.rb}{app/mailers/entry\_mailer.rb}

\section{使用ライブラリ}
「Webシステム」で利用しているGemライブラリは，以下のGemfileの内容の通りである．

\InputSource{../tmp-source/Gemfile}{Gemfile}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{受付システム}
受付システムは1つのフォームから成るシンプルなシステムである．
Webカメラの画像を取得しQRコードをデコード，
そしてブラウザを呼び出しWeb側の受付ページを表示させるシンプルな構成となっている．
\InputSource{../SimpleReceptionSystem/SimpleReceptionSystem/Program.cs.euc}{SimpleReceptionSystem/Program.cs}

以下のコードがメインのコードになる．
QRコードのデコードにはZxingのライブラリを使用した．

\InputSource{../SimpleReceptionSystem/SimpleReceptionSystem/MainWindow.cs.euc}{SimpleReceptionSystem/MainWindow.cs}

\end{document}
